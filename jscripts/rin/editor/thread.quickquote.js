var MYBB_SMILIES={},smileyMapdes2=dropdownsmiliesdes.concat(dropdownsmiliesdesmore),isWebkit="WebkitAppearance"in document.documentElement.style,i;for(i in smileyMapurl)MYBB_SMILIES[smileyMapurl[i]]=smileyMapdes2[i];function isOrContains(b,d){for(;b;){if(b===d)return!0;b=b.parentNode}return!1}
function elementContainsSelection(b){var d;if(window.getSelection){if(d=window.getSelection(),0<d.rangeCount){for(var f=0;f<d.rangeCount;++f)if(!isOrContains(d.getRangeAt(f).commonAncestorContainer,b))return!1;return!0}}else if((d=document.selection)&&"Control"!=d.type)return isOrContains(d.createRange().parentElement(),b);return!1}
function getposition(){var b,d="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2),f={},a;document.selection&&document.selection.createRange?(a=document.selection.createRange().duplicate(),a.collapse(!1),a.pasteHTML('\x3cspan id\x3d"'+d+'" style\x3d"position: relative;"\x3e\x26#xfeff;\x3c/span\x3e'),b=document.getElementById(d)):window.getSelection&&(b=window.getSelection(),b.getRangeAt?a=b.getRangeAt(0).cloneRange():(a=document.createRange(),a.setStart(b.anchorNode,b.anchorOffset),
a.setEnd(b.focusNode,b.focusOffset),a.collapsed!==b.isCollapsed&&(a.setStart(b.focusNode,b.focusOffset),a.setEnd(b.anchorNode,b.anchorOffset))),a.collapse(!1),b=document.createElement("span"),b.id=d,b.appendChild(document.createTextNode("﻿")),a.insertNode(b));if(b){var d=b,c=a=0;do a+=d.offsetLeft,c+=d.offsetTop;while(d=d.offsetParent);f.left=a;f.top=c;b.parentNode.removeChild(b);return f}}var beforeselect=null;
function quick_quote(b,d,f){function a(a){a=$(a.target);a.hasClass("post")||(a=a.parents(".post"));if(a&&a.length&&0==$("#pid_"+b+"").has("form").length){var d=window.getSelection().getRangeAt(0);$.trim(window.getSelection().toString())&&beforeselect!=d?(beforeselect=d,elementContainsSelection(a.find(".post_body")[0])?(a=window.getSelection().getRangeAt(0).getBoundingClientRect(),$elm=$("#qr_pid_"+b+"").show(),$elm.css({top:window.scrollY+a.top+a.height+6+"px",left:getposition().left-$elm.outerWidth()+
10+"px"})):$("#qr_pid_"+b+"").hide()):$("#qr_pid_"+b+"").hide()}else $("#qr_pid_"+b+"").hide()}$("#quick_reply_form").length&&($("#pid_"+b+"").on("mouseup touchend",a),$('body:not("#pid_'+b+'")').click(function(a){$.trim(window.getSelection().toString())||$("#qr_pid_"+b+"").hide()}),$("#qr_pid_"+b+"").click(function(a){a.preventDefault();setTimeout(function(){if(elementContainsSelection(document.getElementById("pid_"+b+""))){Thread.quickQuote(b,""+d+"",f);$("#qr_pid_"+b+"").hide();var a=window.getSelection?
window.getSelection():document.selection;a&&(a.removeAllRanges?a.removeAllRanges():a.empty&&a.empty())}else $("#qr_pid_"+b+"").hide()},200)}))}Thread.quickQuote=function(b,d,f){if(isWebkit||window.getSelection().toString().trim())userSelection=window.getSelection().getRangeAt(0).cloneContents(),b=parseInt(rinvbquote)?"[quote\x3d"+d+";"+b+"]\n":"[quote\x3d'"+d+"' pid\x3d'"+b+"' dateline\x3d'"+f+"']\n",b+=Thread.domToBB(userSelection,MYBB_SMILIES),b+="\n[/quote]\n",delete userSelection,Thread.updateMessageBox(b)};
Thread.updateMessageBox=function(b){MyBBEditor.insertText(b,"","","","quote");setTimeout(function(){offset=$("#quickreply_e").offset().top-60;setTimeout(function(){$("html, body").animate({scrollTop:offset},700)},200)},100)};Thread.RGBtoHex=function(b,d,f){return Thread.toHex(b)+Thread.toHex(d)+Thread.toHex(f)};
Thread.toHex=function(b){if(null==b)return"00";b=parseInt(b);if(0==b||isNaN(b))return"00";b=Math.max(0,b);b=Math.min(b,255);b=Math.round(b);return"0123456789ABCDEF".charAt((b-b%16)/16)+"0123456789ABCDEF".charAt(b%16)};
Thread.domToBB=function(b,d){for(var f="",a,c,g,e,h=0;h<b.childNodes.length;h++)if(a=b.childNodes[h],e=g=c="","undefined"==typeof a.tagName)switch(a.nodeName){case "#text":f+=a.data.replace(/[\n\t]+/,"")}else{switch(a.tagName){case "SPAN":switch(!0){case "underline"==a.style.textDecoration:c="[u]";e="[/u]";break;case 0<a.style.fontWeight:case "bold"==a.style.fontWeight:c="[b]";e="[/b]";break;case "italic"==a.style.fontStyle:c="[i]";e="[/i]";break;case ""!=a.style.fontFamily:c="[font\x3d"+a.style.fontFamily+
"]";e="[/font]";break;case ""!=a.style.fontSize:c="[size\x3d"+a.style.fontSize+"]";e="[/size]";break;case ""!=a.style.color:-1!=a.style.color.indexOf("rgb")?(c=a.style.color.replace("rgb(","").replace(")","").split(","),c="#"+Thread.RGBtoHex(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]))):c=a.style.color,c="[color\x3d"+c+"]",e="[/color]"}break;case "STRONG":case "B":c="[b]";e="[/b]";break;case "EM":case "I":c="[i]";e="[/i]";break;case "U":c="[u]";e="[/u]";break;case "IMG":d[a.src]?(c="",g=d[a.src],
e=""):(c="[img]",g=a.src,e="[/img]");break;case "A":switch(!0){case 0==a.href.indexOf("mailto:"):c="[email\x3d"+a.href.replace("mailto:","")+"]";e="[/email]";break;default:c="[url\x3d"+a.href+"]",e="[/url]"}break;case "OL":c="[list\x3d"+a.type+"]";e="\n[/list]";break;case "UL":c="[list]";e="\n[/list]";break;case "LI":c="\n[*]";e="";break;case "BLOCKQUOTE":a.removeChild(a.firstChild);c="[quote]\n";e="\n[/quote]";break;case "DIV":a.style.textAlign&&(c="[align\x3d"+a.style.textAlign+"]\n",e="\n[/align]\n");
switch(a.className){case "codeblock":c="[code]\n";e="\n[/code]";a.removeChild(a.getElementsByTagName("div")[0]);break;case "codeblock phpcodeblock":g=a.getElementsByTagName("code")[0],a.removeChild(a.getElementsByTagName("div")[0]),c="[php]\n",g=g.innerText?g.innerText:g.innerHTML.replace(/<br([^>]*)>/gi,"\n").replace(/<([^<]+)>/gi,"").replace(/&nbsp;/gi," "),e="\n[/php]"}break;case "P":e="\n\n";break;case "BR":e="\n"}f+=c+g;""==g&&a.childNodes&&0<a.childNodes.length&&(f+=Thread.domToBB(a,d));f+=
e}return f};